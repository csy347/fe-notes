title: golbal.md
date: 2018-05-22 17:25:00
tags: global
categories: Node
---

## 1.控制台

在Node.js中， 使用`console`对象代表控制台(在操作系统中表现为一个操作系统制定的字符界面，比如Window中的命令提示窗口)

* console.log
* console.info
* console.error 重定向到文件
* console.warn
* console.dir
* console.time
* console.timeEnd
* console.trace
* console.assert

## 2.全局作用域

* 全局作用域可以定义一些不需要通过任务模块的加载可使用的变量、函数或类
* 定义全局变量时变量会变成global的属性
* 永远不要使用var关键字定义变量，以免污染全局作用域
* setTimeout clearTimeout
* setInterval clearInterval
* ref unref

``` js
'use strict'
let test = function(){
    console.log('callback');
};

let timer = setInterval(test, 1000);

timer.unref();

setTimeout(function(){
    timer.ref();
}, 3000);

```

## 3.函数

* require
* 模块加载过程
* require.resolve
* 模板缓存(require.cache)
* require.main
* 模块导出
> module.exports, require, module, filename, dirname


## 4.process

### 4.1 process对象

### 4.2 process.nextTick & setImmediate

## 5.Node中的Event Loop

在libuv内部有这样一个事件环机制。在Node启动时会初始化事件环

``` bash
   ┌───────────────────────┐
┌─>│     timers(计时器)     │
|  |   执行setTimeout以及   |
|  |   setInterval的回调。  |
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     I/O callbacks     |
│  | 处理网络、流、tcp的错误   |
|  | callback              |
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     idle, prepare     │
|  |     node内部使用        |
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐       ┌───────────────┐
│  │       poll(轮询)       │       │   incoming:   │
|  | 执行poll中的i/o队列      | <─────┤  connections, │
|  | 检查定时器是否到时        |       │   data, etc.  |
│  └──────────┬────────────┘       └───────────────┘
│  ┌──────────┴────────────┐
│  │      check(检查)       │
|  | 存放setImmediate回调    |
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
└──┤    close callbacks    |
   │ 关闭的回调例如           |
   | sockect.on('close')   |
   └───────────────────────┘
```

> 这里每一个阶段都对应一个事件队列，当event loop执行到某个阶段时会将前阶段对应的队列依次执行。当队列执行完毕或者执行的数量超过上限时，会转入下一个阶段。这里我们重点关注poll阶段

### 5.1 poll阶段

### 5.2 setTimeout 和

二者非常相似，但是二者区别取决于它们什么时候被调用。

* setImmediate 设计在poll阶段完成时执行，即check阶段；
* setTimeout 设计在poll阶段为空闲时，且设定时间到达后执行；但其在timer阶段执行 其二者的调用顺序取决于当前event loop的上下文，如果它们在异步I/O callback 之外调用（在i/o内调用因为下一阶段为check阶段 ），其执行先后顺序是不确定的，需要看loop的执行前的耗时情况。
*
*

## 6.断点调试

### 6.1 命令行

V8 提供了一个强大的调试器，可以通过TCP协议从外部访问。Nodejs提供了一个内建调试器来帮助开发者调试应用程序。想要开启调试器我们需要在代码中加入debugger标签，当Nodejs执行到debugger标签时会自动暂停（debugger标签相当于在代码中开启一个断点）

``` bash
node inspect main.js
```

``` js
var a = 'a';
var b = 'b';

debugger;

var all = a + ' ' + b;
console.log(all);
```

|命令|用途|
|---|---|
|c  |继续执行到下一个断点处

**EventEmitter**

**util**

[参考](http://www.zhufengpeixun.cn/plan/html/6.NodeCore.html)

---

## node浏览器调试

通过`chrome`浏览器进行调试

``` bash
node --inspect-brk main.js
```

> 打开chrome 访问 chrome://inspect

## vscode调试

配置debugger文件

``` bash
    {
        "type": "node",
        "request": "launch",
        "name": "my debugger",
        "program": "${file}",
        "cwd": "${cwd}"
    }

```


---

[来源](https://zhufengzhufeng.github.io/201802/html/7.global.html)
